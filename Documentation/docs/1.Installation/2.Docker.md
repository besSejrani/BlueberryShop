# Docker & Docker-Compose & Make

<hr/>


## Installation

This project relies on Docker, please make sure it is installed on your system, documentation can be found [here](https://docs.docker.com/docker-for-windows/install/).

<hr/>

## Configuration

=== "Dockerfile Example"

```yaml
FROM node:alpine as builder

WORKDIR /app

COPY package*.json .

RUN npm install --force

COPY . .

EXPOSE 3000

CMD ["npm", "run", "dev"]
```

<hr/>

## Docker Compose

For better container management, docker-compose is used in developpement, make sure as well, that it is installed on your system, documentation can be found [here](https://docs.docker.com/compose/).

For custom configuration, the docker-compose.yaml file can be edited to match your use case, documentation can be found [here](https://docs.docker.com/get-started/).

=== "docker-compose.yaml Example"

```yaml
version: "3.8"

services:
  nginx:
    restart: always
    build:
      dockerfile: Dockerfile
      context: ./Nginx
    container_name: nginx
    depends_on:
      - client
      - server
    networks:
      - backend
      - frontend
    ports:
      - "8000:80"
      - "8443:443"
    volumes:
      - ./Nginx/server.crt:/etc/nginx/server.crt
      - ./Nginx/server.key:/etc/nginx/server.key

  client:
    build:
      context: ./Client
    container_name: client
    networks:
      - frontend
    ports:
      - "3000:3000"
    depends_on:
      - server
    volumes:
      - ./Client:/app

  server:
    build:
      context: ./Server
    container_name: server
    networks:
      - backend
      - frontend
    ports:
      - "4000:4000"
    depends_on:
      - mongo
      - redis
    env_file:
      - ./Server/.env
    volumes:
      - ./Server:/app

  redis:
    image: redis:latest
    container_name: redis
    networks:
      - backend
    ports:
      - "6379:6379"
    command: redis-server

  mongo:
    image: mongo
    container_name: mongodb
    restart: always
    ports:
      - 27017:27017
    networks:
      - backend

    volumes:
      - ~/docker/Blueberry/mongo:/data/db

  # ===========================================================================================================================

networks:
  backend:
  frontend:
```

<hr/>

## Run Containers

If all requirements are fullfilled, the following command will help. It will install all service dependencies, create the containers, create the networks and then add the containers to the networks.

=== "Run Containers"

    ```yaml
    docker-compose up
    ```

=== "List Containers"

    ```yaml
    docker-compose ps
    ```

<hr/>

## Services

| Service |     Port     |
| :------ | :----------: |
| Nginx   | 8000 or 8443 |
| Client  |     3000     |
| Server  |     4000     |
| Redis   |     6379     |
| Mongo   |    27017     |

<hr/>
